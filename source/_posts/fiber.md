---
title: fiberå­¦ä¹ ç¬”è®°01
date: 2025-08-14 08:33:04
tags:
---
# Fiber



## Fiberæ¡†æ¶å¿«é€Ÿå…¥é—¨


å…ˆæ³¨å†ŒRestæ–¹æ³•å’Œè·¯ç”±URLä»¥åŠå¯¹åº”çš„å¤„ç†å™¨,å¤„ç†å™¨éœ€è¦æ»¡è¶³func(*Ctx) error
func (app *App) Get(path string, handlers ...Handler) Router

```bash

func main(){
    #é€šè¿‡åŒ¿åå‡½æ•°ä¼ å…¥handler
	app := fiber.New()
		app.Get("/health", func(c *fiber.Ctx) error {
		return c.JSON(fiber.Map{"status": "ok"})
	})
	
}
```
ä½¿ç”¨APP.Listenæ–¹æ³•å¯åŠ¨æœåŠ¡å™¨ï¼ŒæŒ‡å®šç›‘å¬ç«¯å£å·.ç›‘å¬æˆåŠŸåˆ™ä¼šé˜»å¡ä¸»åç¨‹
```bash
	log.Printf("listening on %s", "127.0.0.1:8080")
	if err := app.Listen(addr); err != nil {
		log.Fatal(err)
	}
```

## Fiberæ¡†æ¶è¯·æ±‚å¤„ç†

handlerå‡½æ•°çš„å…¥å‚context å°è£…äº†è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰ä¿¡æ¯ã€‚  
é€šè¿‡context.Request().Bodyè·å–è¯·æ±‚ä½“ï¼Œæ˜¯ä¸€ä¸ªbyteåˆ‡ç‰‡(ä¸æ˜¯æµ)ï¼Œå¯ä»¥åå¤è¯»å–ã€‚  
é€šè¿‡context.Response().BodyWriterè®¾ç½®å“åº”ä½“ï¼Œå¯ä»¥å†™å…¥byteåˆ‡ç‰‡æˆ–å­—ç¬¦ä¸²ã€‚  
å¯ä»¥è®¾ç½®å“åº”å¤´å’ŒçŠ¶æ€ç ï¼Œè®¾ç½®é¡ºåºä¸é™ã€‚  
ä½¿ç”¨context.SendStatus()è®¾ç½®çŠ¶æ€ç ï¼Œå»ºè®®ç”¨äºä»…è®¾ç½®çŠ¶æ€ç çš„åœºæ™¯ã€‚
## ğŸ“‹ ç«‹å³å“åº”æ–¹æ³•å¯¹æ¯”è¡¨

| æ–¹æ³•             | æè¿°                                                         | ç¤ºä¾‹ä»£ç                                                    |
|------------------|--------------------------------------------------------------|------------------------------------------------------------|
| `SendStatus()`   | è®¾ç½® HTTP çŠ¶æ€ç å¹¶ç«‹å³å‘é€å“åº”ï¼Œå“åº”ä½“ä¸ºç©ºæ—¶ä¼šè‡ªåŠ¨å¡«å……çŠ¶æ€æ¶ˆæ¯ã€‚ | `return c.SendStatus(fiber.StatusNotFound)`                |
| `SendString()`   | è®¾ç½®å“åº”ä½“ä¸ºå­—ç¬¦ä¸²å¹¶å‘é€ã€‚                                    | `return c.SendString("Hello, World!")`                     |
| `Send()`         | è®¾ç½®å“åº”ä½“ä¸ºå­—èŠ‚åˆ‡ç‰‡å¹¶å‘é€ã€‚                                  | `return c.Send([]byte("Hello, World!"))`                   |
| `SendStream()`   | è®¾ç½®å“åº”ä½“ä¸ºæµå¹¶å‘é€ã€‚                                        | `return c.SendStream(bytes.NewReader([]byte("Hello, World!")))` |


## ğŸ“‹ å»¶æ—¶å“åº”æ–¹æ³•å¯¹æ¯”è¡¨

| æ–¹æ³•                  | æè¿°                                                         | ç¤ºä¾‹ä»£ç                                                    |
|-----------------------|--------------------------------------------------------------|------------------------------------------------------------|
| `Status()`            | è®¾ç½®å“åº”çš„çŠ¶æ€ç ï¼Œé€šå¸¸ä¸å…¶ä»–æ–¹æ³•é“¾å¼è°ƒç”¨ã€‚                   | `return c.Status(fiber.StatusOK).SendString("Success")`    |
| `Set()`               | è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯ã€‚                                           | `c.Set("X-Custom-Header", "Value")`                        |
| `Append()`            | å‘å“åº”å¤´éƒ¨æ·»åŠ å€¼ã€‚                                           | `c.Append("Set-Cookie", "session=abc123")`                 |
| `Attachment()`        | è®¾ç½®å“åº”çš„ Content-Disposition ä¸ºé™„ä»¶ã€‚                     | `c.Attachment("file.txt")`                                 |
| `JSON()`              | è®¾ç½®å“åº”ä½“ä¸º JSON æ ¼å¼å¹¶å‘é€ã€‚                               | `return c.JSON(fiber.Map{"status": "ok"})`                 |
| `SendFile()`          | å‘é€æ–‡ä»¶ä½œä¸ºå“åº”ä½“ã€‚                                         | `return c.SendFile("/path/to/file.txt")`                   |
| `SendStreamWriter()`  | è®¾ç½®å“åº”ä½“ä¸ºæµå†™å…¥å™¨å¹¶å‘é€ã€‚                                 | `return c.SendStreamWriter(func(w *bufio.Writer) { fmt.Fprintf(w, "Hello, World!") })` |


### å»ºè®®ä½¿ç”¨åœºæ™¯

- **ä»…è¿”å›çŠ¶æ€ç ï¼Œæ— æ­£æ–‡**ï¼šä½¿ç”¨ SendStatus()ã€‚   
- **è¿”å›ç®€å•æ–‡æœ¬å“åº”**ï¼šä½¿ç”¨ SendString()ã€‚
- **è¿”å›äºŒè¿›åˆ¶æ•°æ®æˆ–è‡ªå®šä¹‰æ ¼å¼å“åº”**ï¼šä½¿ç”¨ Send()ã€‚
- **å¤§æ–‡ä»¶ä¼ è¾“æˆ–å®æ—¶æ•°æ®æµ**ï¼šä½¿ç”¨ SendStream()ã€‚
- **è®¾ç½®å“åº”çŠ¶æ€ç å¹¶å‘é€å“åº”**ï¼šä½¿ç”¨ `Status()`ã€‚
- **è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯**ï¼šä½¿ç”¨ `Set()`ã€‚
- **å‘å“åº”å¤´éƒ¨æ·»åŠ å€¼**ï¼šä½¿ç”¨ `Append()`ã€‚
- **è®¾ç½®å“åº”ä¸ºé™„ä»¶**ï¼šä½¿ç”¨ `Attachment()`ã€‚
- **è¿”å› JSON æ ¼å¼å“åº”**ï¼šä½¿ç”¨ `JSON()`ã€‚
- **å‘é€æ–‡ä»¶ä½œä¸ºå“åº”ä½“**ï¼šä½¿ç”¨ `SendFile()`ã€‚
- **å¤§æ–‡ä»¶ä¼ è¾“æˆ–å®æ—¶æ•°æ®æµ**ï¼šä½¿ç”¨ `SendStreamWriter()`ã€‚:contentReference[oaicite:62]{index=62}

## Fiberæ¡†æ¶ä¸­é—´ä»¶å®‰è£…

Fiberæ¡†æ¶ä¸è‡ªå¸¦ä¸­é—´ä»¶ï¼Œéœ€è¦æ˜¾å¼å®‰è£…ã€‚   
å®‰è£…æ—¥å¿—å’Œæ¢å¤ä¸­é—´ä»¶ï¼Œä½¿ç”¨useæ–¹æ³•ã€‚   
æ—¥å¿—ä¸­é—´ä»¶æŒ‡å®šè¾“å‡ºæ ¼å¼ã€æ—¶åŒºå’Œè¾“å‡ºä½ç½®ã€‚   
æ¢å¤ä¸­é—´ä»¶ç”¨äºæ•è·è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒã€‚  

```bash

	logFile, _ := os.OpenFile("./fiber.log", os.O_APPEND|os.O_CREATE|os.O_WRONLY, os.ModePerm)

	app.Use(logger.New(logger.Config{
		TimeFormat:    "2006-01-02 15:04:05",
		TimeZone:      "America/Sao_Paulo",
		DisableColors: true,
		Output:        logFile,
	}))

	app.Use(recover.New())
```


Fiber çš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹(Like Java-Netty ChannelPipeLine)ï¼š

è¯·æ±‚é¦–å…ˆç»è¿‡æ‰€æœ‰æ³¨å†Œçš„ä¸­é—´ä»¶ã€‚
- æ¯ä¸ªä¸­é—´ä»¶å¯ä»¥é€‰æ‹©æ˜¯å¦è°ƒç”¨ next()ï¼Œå°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è·¯ç”±å¤„ç†å‡½æ•°ã€‚   
- å¦‚æœæ‰€æœ‰ä¸­é—´ä»¶éƒ½è°ƒç”¨äº† next()ï¼Œè¯·æ±‚å°†åˆ°è¾¾è·¯ç”±å¤„ç†å‡½æ•°ï¼Œç”Ÿæˆå“åº”ã€‚   
- å“åº”è¿”å›æ—¶ï¼Œæ‰€æœ‰ä¸­é—´ä»¶å°†æŒ‰ç›¸åçš„é¡ºåºæ‰§è¡Œï¼Œè¿›è¡Œåå¤„ç†ã€‚   
- è¿™ç§æœºåˆ¶ä½¿å¾—å¯ä»¥åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­æ’å…¥æ—¥å¿—è®°å½•ã€é”™è¯¯æ¢å¤ã€èº«ä»½éªŒè¯ç­‰åŠŸèƒ½ï¼Œå®ç°é«˜åº¦çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚   

**è‡ªå®šä¹‰ä¸­é—´ä»¶**
```bash
func customMiddleware(c *fiber.Ctx) error {

	fmt.Println("customMiddleware å‰å¤„ç†")
	// åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰æ‰§è¡Œçš„é€»è¾‘ // ... //
	err := c.Next()
	if err != nil {
		return nil
	}
	// åœ¨å“åº”å†™å…¥åæ‰§è¡Œçš„é€»è¾‘
	// è·å–å“åº”ä½“çš„å†™å…¥å™¨
	bodyWriter := c.Response().BodyWriter()
	_, err = bodyWriter.Write([]byte("ä¸­é—´ä»¶åå¤„ç†è¿½åŠ å†…å®¹"))
	fmt.Println("customMiddleware åå¤„ç†")
	if err != nil {
		return nil
	}

	return nil

}
```